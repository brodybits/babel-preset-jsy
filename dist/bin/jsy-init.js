#!/usr/bin/env node
'use strict';

const babel_preset_jsy_json = require('../../package.json');
const fs = require('fs');

const argv = process.argv.slice(2);

let jsy_mode = 'jsy';
let jsy_options;
const jsy_option_sets = { no_stage_3: { no_stage_3: true }, all: { stage_3: true,
    targets: { node: true, browser: true }, offside: { check_blocks: '\/node_modules\/|\\node_modules\\/' } } };

if (argv.includes('--help')) {
  console.log(['', '  Usage: jsy-init [options]', '', '  Purpose: Configures the package.json with Babel settings, devDependencies, and common scripts for quickly starting a new project.', '', '  Options:', '', '    --help            output usage information', '    --lean            add concise babel config option to exclude stage_3 preset (used to prevent async/await code generation)', '    --no_stage_3      add babel config option to exclude stage_3 preset (used to prevent async/await code generation)', '    --options         add all babel config options for JSY for later editing', ''].join('\n'));
} else {
  if (argv.includes('--lean')) {
    jsy_mode = 'jsy/lean';
  }

  if (argv.includes('--no_stage_3' || argv.includes('--no_stage3'))) {
    jsy_options = Object.assign({}, jsy_options, jsy_option_sets.no_stage_3);
  }

  if (argv.includes('--options')) {
    jsy_options = Object.assign({}, jsy_options, jsy_option_sets.all);
  }

  transformPackageJson();
}

function transformPackageJson(filename = './package.json') {
  new Promise((resolve, reject) => fs.readFile(filename, 'utf-8', (err, content) => err ? reject(err) : resolve(content))).then(content => JSON.parse(content)).then(pkg => {
    console.log(['', `Merging settings into "${filename}":`, JSON.stringify(setupPackageJson({}), null, 2), ''].join('\n'));
    return setupPackageJson(pkg);
  }).then(pkg => JSON.stringify(pkg, null, 2)).then(content => new Promise((resolve, reject) => fs.writeFile(filename, content, err => err ? reject(err) : resolve(content)))).then(content => console.log(`Wrote merged JSY settings into "${filename}"`));
}

function setupPackageJson(pkg) {
  pkg.devDependencies = setupDevDependencies(pkg.devDependencies || {});
  pkg.babel = setupBabelPresets(pkg.babel || {});
  pkg.scripts = setupScripts(pkg.scripts || {});
  return pkg;
}

function setupDevDependencies(devDependencies) {
  devDependencies['babel-cli'] = babel_preset_jsy_json.devDependencies['babel-cli'];
  devDependencies['babel-preset-jsy'] = `^${babel_preset_jsy_json.version}`;
  devDependencies['nodemon'] = '*';
  return devDependencies;
}

const existing_jsy_modes = new Set(['jsy', 'jsy/lean']);

function setupBabelPresets(babel) {
  if (!babel.presets) {
    babel.presets = [];
  } else if ('string' === babel.presets) {
    babel.presets = [babel.presets];
  }

  if (babel.presets.find(e => existing_jsy_modes.has(e) || existing_jsy_modes.has(e[0]))) {
    console.log('Existing JSY settings found. Please edit Babel settings manually');
  } else {
    babel.presets.push(jsy_options ? [jsy_mode, jsy_options] : jsy_mode);
  }

  return babel;
}

function setupScripts(scripts) {
  if (!scripts.start) {
    scripts.start = 'node dist';
  }

  if (!scripts['start:dev']) {
    scripts['start:dev'] = 'nodemon -d 2 dist';
  }

  if (!scripts.build) {
    scripts.build = 'babel -s inline -x .js,.jsy code -d dist';
  }

  if (!scripts.watch) {
    scripts.watch = 'npm -s run build -- --watch';
  }

  if (!scripts.pretest) {
    scripts.pretest = 'npm -s run build';
  }

  if (!scripts.testone) {
    scripts.testone = 'babel-node test/example.jsy';
  }

  return scripts;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvZGUvYmluL2pzeS1pbml0LmpzIl0sIm5hbWVzIjpbImJhYmVsX3ByZXNldF9qc3lfanNvbiIsInJlcXVpcmUiLCJmcyIsImFyZ3YiLCJwcm9jZXNzIiwic2xpY2UiLCJqc3lfbW9kZSIsImpzeV9vcHRpb25zIiwianN5X29wdGlvbl9zZXRzIiwibm9fc3RhZ2VfMyIsImFsbCIsInN0YWdlXzMiLCJ0YXJnZXRzIiwibm9kZSIsImJyb3dzZXIiLCJvZmZzaWRlIiwiY2hlY2tfYmxvY2tzIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwibG9nIiwiam9pbiIsIk9iamVjdCIsImFzc2lnbiIsInRyYW5zZm9ybVBhY2thZ2VKc29uIiwiZmlsZW5hbWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlYWRGaWxlIiwiZXJyIiwiY29udGVudCIsInRoZW4iLCJKU09OIiwicGFyc2UiLCJwa2ciLCJzdHJpbmdpZnkiLCJzZXR1cFBhY2thZ2VKc29uIiwid3JpdGVGaWxlIiwiZGV2RGVwZW5kZW5jaWVzIiwic2V0dXBEZXZEZXBlbmRlbmNpZXMiLCJiYWJlbCIsInNldHVwQmFiZWxQcmVzZXRzIiwic2NyaXB0cyIsInNldHVwU2NyaXB0cyIsInZlcnNpb24iLCJleGlzdGluZ19qc3lfbW9kZXMiLCJTZXQiLCJwcmVzZXRzIiwiZmluZCIsImUiLCJoYXMiLCJwdXNoIiwic3RhcnQiLCJidWlsZCIsIndhdGNoIiwicHJldGVzdCIsInRlc3RvbmUiXSwibWFwcGluZ3MiOiI7O0FBQ0EsTUFBTUEsd0JBQXdCQyxRQUFRLG9CQUFSLENBQTlCO0FBQ0EsTUFBTUMsS0FBS0QsUUFBUSxJQUFSLENBQVg7O0FBRUEsTUFBTUUsT0FBT0MsUUFBUUQsSUFBUixDQUFhRSxLQUFiLENBQW1CLENBQW5CLENBQWI7O0FBRUEsSUFBSUMsV0FBUyxLQUFiO0FBQ0EsSUFBSUMsV0FBSjtBQUNBLE1BQU1DLGtCQUNKLEVBQUlDLFlBQ0UsRUFBSUEsWUFBWSxJQUFoQixFQURO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MkI7QUFDekJBLFlBQVEsV0FBUixJQUF1QixtQkFBdkI7QUFBMEM7O0FBRTVDLE1BQUcsQ0FBQ0EsUUFBUVcsS0FBWixFQUFvQjtBQUNsQlgsWUFBUVcsS0FBUixHQUFnQiwwQ0FBaEI7QUFBMEQ7O0FBRTVELE1BQUcsQ0FBQ1gsUUFBUVksS0FBWixFQUFvQjtBQUNsQlosWUFBUVksS0FBUixHQUFnQiw2QkFBaEI7QUFBNkM7O0FBRS9DLE1BQUcsQ0FBQ1osUUFBUWEsT0FBWixFQUFzQjtBQUNwQmIsWUFBUWEsT0FBUixHQUFrQixrQkFBbEI7QUFBb0M7O0FBRXRDLE1BQUcsQ0FBQ2IsUUFBUWMsT0FBWixFQUFzQjtBQUNwQmQsWUFBUWMsT0FBUixHQUFrQiw2QkFBbEI7QUFBK0M7O0FBRWpELFNBQU9kLE9BQVA7QUFBYyIsImZpbGUiOiJqc3ktaW5pdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuY29uc3QgYmFiZWxfcHJlc2V0X2pzeV9qc29uID0gcmVxdWlyZSgnLi4vLi4vcGFja2FnZS5qc29uJylcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxuXG5jb25zdCBhcmd2ID0gcHJvY2Vzcy5hcmd2LnNsaWNlKDIpXG5cbmxldCBqc3lfbW9kZT0nanN5J1xubGV0IGpzeV9vcHRpb25zXG5jb25zdCBqc3lfb3B0aW9uX3NldHMgPVxuICBAe30gbm9fc3RhZ2VfMzpcbiAgICAgICAgQHt9IG5vX3N0YWdlXzM6IHRydWVcbiAgICAsIGFsbDpcbiAgICAgICAgQHt9IHN0YWdlXzM6IHRydWVcbiAgICAgICAgICAsIHRhcmdldHM6IEB7fSBub2RlOiB0cnVlLCBicm93c2VyOiB0cnVlXG4gICAgICAgICAgLCBvZmZzaWRlOiBAe30gY2hlY2tfYmxvY2tzOiAnXFwvbm9kZV9tb2R1bGVzXFwvfFxcXFxub2RlX21vZHVsZXNcXFxcLydcblxuaWYgYXJndi5pbmNsdWRlcyBAICctLWhlbHAnIDo6XG4gIGNvbnNvbGUubG9nIEBcbiAgICBAW10gJydcbiAgICAgICwgJyAgVXNhZ2U6IGpzeS1pbml0IFtvcHRpb25zXSdcbiAgICAgICwgJydcbiAgICAgICwgJyAgUHVycG9zZTogQ29uZmlndXJlcyB0aGUgcGFja2FnZS5qc29uIHdpdGggQmFiZWwgc2V0dGluZ3MsIGRldkRlcGVuZGVuY2llcywgYW5kIGNvbW1vbiBzY3JpcHRzIGZvciBxdWlja2x5IHN0YXJ0aW5nIGEgbmV3IHByb2plY3QuJ1xuICAgICAgLCAnJ1xuICAgICAgLCAnICBPcHRpb25zOidcbiAgICAgICwgJydcbiAgICAgICwgJyAgICAtLWhlbHAgICAgICAgICAgICBvdXRwdXQgdXNhZ2UgaW5mb3JtYXRpb24nXG4gICAgICAsICcgICAgLS1sZWFuICAgICAgICAgICAgYWRkIGNvbmNpc2UgYmFiZWwgY29uZmlnIG9wdGlvbiB0byBleGNsdWRlIHN0YWdlXzMgcHJlc2V0ICh1c2VkIHRvIHByZXZlbnQgYXN5bmMvYXdhaXQgY29kZSBnZW5lcmF0aW9uKSdcbiAgICAgICwgJyAgICAtLW5vX3N0YWdlXzMgICAgICBhZGQgYmFiZWwgY29uZmlnIG9wdGlvbiB0byBleGNsdWRlIHN0YWdlXzMgcHJlc2V0ICh1c2VkIHRvIHByZXZlbnQgYXN5bmMvYXdhaXQgY29kZSBnZW5lcmF0aW9uKSdcbiAgICAgICwgJyAgICAtLW9wdGlvbnMgICAgICAgICBhZGQgYWxsIGJhYmVsIGNvbmZpZyBvcHRpb25zIGZvciBKU1kgZm9yIGxhdGVyIGVkaXRpbmcnXG4gICAgICAsICcnXG4gICAgLmpvaW4oJ1xcbicpXG5cbmVsc2UgOjpcbiAgaWYgYXJndi5pbmNsdWRlcyBAICctLWxlYW4nIDo6XG4gICAganN5X21vZGUgPSAnanN5L2xlYW4nXG5cbiAgaWYgYXJndi5pbmNsdWRlcyBAICctLW5vX3N0YWdlXzMnIHx8IGFyZ3YuaW5jbHVkZXMgQCAnLS1ub19zdGFnZTMnIDo6XG4gICAganN5X29wdGlvbnMgPSBPYmplY3QuYXNzaWduIEAge30sIGpzeV9vcHRpb25zLCBqc3lfb3B0aW9uX3NldHMubm9fc3RhZ2VfM1xuXG4gIGlmIGFyZ3YuaW5jbHVkZXMgQCAnLS1vcHRpb25zJyA6OlxuICAgIGpzeV9vcHRpb25zID0gT2JqZWN0LmFzc2lnbiBAIHt9LCBqc3lfb3B0aW9ucywganN5X29wdGlvbl9zZXRzLmFsbFxuXG4gIHRyYW5zZm9ybVBhY2thZ2VKc29uKClcblxuXG5mdW5jdGlvbiB0cmFuc2Zvcm1QYWNrYWdlSnNvbihmaWxlbmFtZT0nLi9wYWNrYWdlLmpzb24nKSA6OlxuICBuZXcgUHJvbWlzZSBAIChyZXNvbHZlLCByZWplY3QpID0+XG4gICAgZnMucmVhZEZpbGUgQCBmaWxlbmFtZSwgJ3V0Zi04JyxcbiAgICAgIChlcnIsIGNvbnRlbnQpID0+IGVyciA/IHJlamVjdChlcnIpIDogcmVzb2x2ZShjb250ZW50KVxuXG4gIC50aGVuIEAgY29udGVudCA9PiBKU09OLnBhcnNlIEAgY29udGVudFxuXG4gIC50aGVuIEAgcGtnID0+IDo6XG4gICAgY29uc29sZS5sb2cgQFxuICAgICAgQFtdICcnLCBgTWVyZ2luZyBzZXR0aW5ncyBpbnRvIFwiJHtmaWxlbmFtZX1cIjpgXG4gICAgICAgICwgSlNPTi5zdHJpbmdpZnkgQCBzZXR1cFBhY2thZ2VKc29uKHt9KSwgbnVsbCwgMlxuICAgICAgICAsICcnXG4gICAgICAuam9pbignXFxuJylcbiAgICByZXR1cm4gc2V0dXBQYWNrYWdlSnNvbihwa2cpXG5cbiAgLnRoZW4gQCBwa2cgPT4gSlNPTi5zdHJpbmdpZnkocGtnLCBudWxsLCAyKVxuXG4gIC50aGVuIEAgY29udGVudCA9PlxuICAgIG5ldyBQcm9taXNlIEAgKHJlc29sdmUsIHJlamVjdCkgPT5cbiAgICAgIGZzLndyaXRlRmlsZSBAIGZpbGVuYW1lLCBjb250ZW50LFxuICAgICAgICAoZXJyKSA9PiBlcnIgPyByZWplY3QoZXJyKSA6IHJlc29sdmUoY29udGVudClcblxuICAudGhlbiBAIGNvbnRlbnQgPT4gY29uc29sZS5sb2cgQCBgV3JvdGUgbWVyZ2VkIEpTWSBzZXR0aW5ncyBpbnRvIFwiJHtmaWxlbmFtZX1cImBcblxuXG5mdW5jdGlvbiBzZXR1cFBhY2thZ2VKc29uKHBrZykgOjpcbiAgcGtnLmRldkRlcGVuZGVuY2llcyA9IHNldHVwRGV2RGVwZW5kZW5jaWVzIEAgcGtnLmRldkRlcGVuZGVuY2llcyB8fCB7fVxuICBwa2cuYmFiZWwgPSBzZXR1cEJhYmVsUHJlc2V0cyBAIHBrZy5iYWJlbCB8fCB7fVxuICBwa2cuc2NyaXB0cyA9IHNldHVwU2NyaXB0cyBAIHBrZy5zY3JpcHRzIHx8IHt9XG4gIHJldHVybiBwa2dcblxuXG5mdW5jdGlvbiBzZXR1cERldkRlcGVuZGVuY2llcyhkZXZEZXBlbmRlbmNpZXMpIDo6XG4gIGRldkRlcGVuZGVuY2llc1snYmFiZWwtY2xpJ10gPSBiYWJlbF9wcmVzZXRfanN5X2pzb24uZGV2RGVwZW5kZW5jaWVzWydiYWJlbC1jbGknXVxuICBkZXZEZXBlbmRlbmNpZXNbJ2JhYmVsLXByZXNldC1qc3knXSA9IGBeJHtiYWJlbF9wcmVzZXRfanN5X2pzb24udmVyc2lvbn1gXG4gIGRldkRlcGVuZGVuY2llc1snbm9kZW1vbiddID0gJyonXG4gIHJldHVybiBkZXZEZXBlbmRlbmNpZXNcblxuXG5jb25zdCBleGlzdGluZ19qc3lfbW9kZXMgPSBuZXcgU2V0IEAjICdqc3knLCAnanN5L2xlYW4nXG5cbmZ1bmN0aW9uIHNldHVwQmFiZWxQcmVzZXRzKGJhYmVsKSA6OlxuICBpZiAhIGJhYmVsLnByZXNldHMgOjpcbiAgICBiYWJlbC5wcmVzZXRzID0gW11cbiAgZWxzZSBpZiAnc3RyaW5nJyA9PT0gYmFiZWwucHJlc2V0cyA6OlxuICAgIGJhYmVsLnByZXNldHMgPSBbYmFiZWwucHJlc2V0c11cblxuICBpZiBiYWJlbC5wcmVzZXRzLmZpbmQgQCBlID0+IGV4aXN0aW5nX2pzeV9tb2Rlcy5oYXMoZSkgfHwgZXhpc3RpbmdfanN5X21vZGVzLmhhcyhlWzBdKSA6OlxuICAgIGNvbnNvbGUubG9nIEAgJ0V4aXN0aW5nIEpTWSBzZXR0aW5ncyBmb3VuZC4gUGxlYXNlIGVkaXQgQmFiZWwgc2V0dGluZ3MgbWFudWFsbHknXG4gIGVsc2UgOjpcbiAgICBiYWJlbC5wcmVzZXRzLnB1c2ggQCBqc3lfb3B0aW9ucyA/IFtqc3lfbW9kZSwganN5X29wdGlvbnNdIDoganN5X21vZGVcblxuICByZXR1cm4gYmFiZWxcblxuZnVuY3Rpb24gc2V0dXBTY3JpcHRzKHNjcmlwdHMpIDo6XG4gIGlmICFzY3JpcHRzLnN0YXJ0IDo6XG4gICAgc2NyaXB0cy5zdGFydCA9ICdub2RlIGRpc3QnXG5cbiAgaWYgIXNjcmlwdHNbJ3N0YXJ0OmRldiddIDo6XG4gICAgc2NyaXB0c1snc3RhcnQ6ZGV2J10gPSAnbm9kZW1vbiAtZCAyIGRpc3QnXG5cbiAgaWYgIXNjcmlwdHMuYnVpbGQgOjpcbiAgICBzY3JpcHRzLmJ1aWxkID0gJ2JhYmVsIC1zIGlubGluZSAteCAuanMsLmpzeSBjb2RlIC1kIGRpc3QnXG5cbiAgaWYgIXNjcmlwdHMud2F0Y2ggOjpcbiAgICBzY3JpcHRzLndhdGNoID0gJ25wbSAtcyBydW4gYnVpbGQgLS0gLS13YXRjaCdcblxuICBpZiAhc2NyaXB0cy5wcmV0ZXN0IDo6XG4gICAgc2NyaXB0cy5wcmV0ZXN0ID0gJ25wbSAtcyBydW4gYnVpbGQnXG5cbiAgaWYgIXNjcmlwdHMudGVzdG9uZSA6OlxuICAgIHNjcmlwdHMudGVzdG9uZSA9ICdiYWJlbC1ub2RlIHRlc3QvZXhhbXBsZS5qc3knXG5cbiAgcmV0dXJuIHNjcmlwdHNcblxuIl19