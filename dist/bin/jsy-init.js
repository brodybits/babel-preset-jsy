#!/usr/bin/env node
'use strict';

const babel_preset_jsy_json = require('../../package.json');
const fs = require('fs');

const argv = process.argv.slice(2);
let jsy_options;
const jsy_option_sets = { no_stage_3: { no_stage_3: true }, all: { stage_3: true,
    targets: { node: true, browser: true }, offside: { check_blocks: '\/node_modules\/|\\node_modules\\/' } } };

if (argv.includes('--help')) {
  console.log(['', '  Usage: jsy-init [options]', '', '  Purpose: Configures the package.json with Babel settings, devDependencies, and common scripts for quickly starting a new project.', '', '  Options:', '', '    --help            output usage information', '    --no_stage_3      add babel config option to exclude stage_3 preset (used to prevent async/await code generation)', '    --options         add all babel config options for JSY for later editing', ''].join('\n'));
} else {
  if (argv.includes('--no_stage_3' || argv.includes('--no_stage3'))) {
    jsy_options = Object.assign({}, jsy_options, jsy_option_sets.no_stage_3);
  }

  if (argv.includes('--options')) {
    jsy_options = Object.assign({}, jsy_options, jsy_option_sets.all);
  }

  transformPackageJson();
}

function transformPackageJson(filename = './package.json') {
  new Promise((resolve, reject) => fs.readFile(filename, 'utf-8', (err, content) => err ? reject(err) : resolve(content))).then(content => JSON.parse(content)).then(pkg => {
    console.log(['', `Merging settings into "${filename}":`, JSON.stringify(setupPackageJson({}), null, 2), ''].join('\n'));
    return setupPackageJson(pkg);
  }).then(pkg => JSON.stringify(pkg, null, 2)).then(content => new Promise((resolve, reject) => fs.writeFile(filename, content, err => err ? reject(err) : resolve(content)))).then(content => console.log(`Wrote merged JSY settings into "${filename}"`));
}

function setupPackageJson(pkg) {
  pkg.devDependencies = setupDevDependencies(pkg.devDependencies || {});
  pkg.babel = setupBabelPresets(pkg.babel || {});
  pkg.scripts = setupScripts(pkg.scripts || {});
  return pkg;
}

function setupDevDependencies(devDependencies) {
  devDependencies['babel-cli'] = babel_preset_jsy_json.devDependencies['babel-cli'];
  devDependencies['babel-preset-jsy'] = `^${babel_preset_jsy_json.version}`;
  devDependencies['nodemon'] = '*';
  return devDependencies;
}

const existing_jsy_modes = new Set(['jsy', 'jsy/lean']);

function setupBabelPresets(babel) {
  if (!babel.presets) {
    babel.presets = [];
  } else if ('string' === babel.presets) {
    babel.presets = [babel.presets];
  }

  if (babel.presets.find(e => existing_jsy_modes.has(e) || existing_jsy_modes.has(e[0]))) {
    console.log('Existing JSY settings found. Please edit Babel settings manually');
  } else {
    babel.presets.push(jsy_options ? [jsy_mode, jsy_options] : jsy_mode);
  }

  return babel;
}

function setupScripts(scripts) {
  if (!scripts.start) {
    scripts.start = 'node dist';
  }

  if (!scripts['start:dev']) {
    scripts['start:dev'] = 'nodemon -d 2 dist';
  }

  if (!scripts.build) {
    scripts.build = 'babel -s inline -x .js,.jsy code -d dist';
  }

  if (!scripts.watch) {
    scripts.watch = 'npm -s run build -- --watch';
  }

  if (!scripts.pretest) {
    scripts.pretest = 'npm -s run build';
  }

  if (!scripts.testone) {
    scripts.testone = 'babel-node test/example.jsy';
  }

  return scripts;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2NvZGUvYmluL2pzeS1pbml0LmpzIl0sIm5hbWVzIjpbImJhYmVsX3ByZXNldF9qc3lfanNvbiIsInJlcXVpcmUiLCJmcyIsImFyZ3YiLCJwcm9jZXNzIiwic2xpY2UiLCJqc3lfb3B0aW9ucyIsImpzeV9vcHRpb25fc2V0cyIsIm5vX3N0YWdlXzMiLCJhbGwiLCJzdGFnZV8zIiwidGFyZ2V0cyIsIm5vZGUiLCJicm93c2VyIiwib2Zmc2lkZSIsImNoZWNrX2Jsb2NrcyIsImluY2x1ZGVzIiwiY29uc29sZSIsImxvZyIsImpvaW4iLCJPYmplY3QiLCJhc3NpZ24iLCJ0cmFuc2Zvcm1QYWNrYWdlSnNvbiIsImZpbGVuYW1lIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJyZWFkRmlsZSIsImVyciIsImNvbnRlbnQiLCJ0aGVuIiwiSlNPTiIsInBhcnNlIiwicGtnIiwic3RyaW5naWZ5Iiwic2V0dXBQYWNrYWdlSnNvbiIsIndyaXRlRmlsZSIsImRldkRlcGVuZGVuY2llcyIsInNldHVwRGV2RGVwZW5kZW5jaWVzIiwiYmFiZWwiLCJzZXR1cEJhYmVsUHJlc2V0cyIsInNjcmlwdHMiLCJzZXR1cFNjcmlwdHMiLCJ2ZXJzaW9uIiwiZXhpc3RpbmdfanN5X21vZGVzIiwiU2V0IiwicHJlc2V0cyIsImZpbmQiLCJlIiwiaGFzIiwicHVzaCIsImpzeV9tb2RlIiwic3RhcnQiLCJidWlsZCIsIndhdGNoIiwicHJldGVzdCIsInRlc3RvbmUiXSwibWFwcGluZ3MiOiI7O0FBQ0EsTUFBTUEsd0JBQXdCQyxRQUFRLG9CQUFSLENBQTlCO0FBQ0EsTUFBTUMsS0FBS0QsUUFBUSxJQUFSLENBQVg7O0FBRUEsTUFBTUUsT0FBT0MsUUFBUUQsSUFBUixDQUFhRSxLQUFiLENBQW1CLENBQW5CLENBQWI7QUFDQSxJQUFJQyxXQUFKO0FBQ0EsTUFBTUMsa0JBQ0osRUFBSUMsWUFDRSxFQUFJQSxZQUFZLElBQWhCLEVBRE4sRUFFSUMsS0FDRSxFQUFJQyxTQUFT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aEI7QUFBMEQ7O0FBRTVELE1BQUcsQ0FBQ1osUUFBUWEsS0FBWixFQUFvQjtBQUNsQmIsWUFBUWEsS0FBUixHQUFnQiw2QkFBaEI7QUFBNkM7O0FBRS9DLE1BQUcsQ0FBQ2IsUUFBUWMsT0FBWixFQUFzQjtBQUNwQmQsWUFBUWMsT0FBUixHQUFrQixrQkFBbEI7QUFBb0M7O0FBRXRDLE1BQUcsQ0FBQ2QsUUFBUWUsT0FBWixFQUFzQjtBQUNwQmYsWUFBUWUsT0FBUixHQUFrQiw2QkFBbEI7QUFBK0M7O0FBRWpELFNBQU9mLE9BQVA7QUFBYyIsImZpbGUiOiJqc3ktaW5pdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuY29uc3QgYmFiZWxfcHJlc2V0X2pzeV9qc29uID0gcmVxdWlyZSgnLi4vLi4vcGFja2FnZS5qc29uJylcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxuXG5jb25zdCBhcmd2ID0gcHJvY2Vzcy5hcmd2LnNsaWNlKDIpXG5sZXQganN5X29wdGlvbnNcbmNvbnN0IGpzeV9vcHRpb25fc2V0cyA9XG4gIEB7fSBub19zdGFnZV8zOlxuICAgICAgICBAe30gbm9fc3RhZ2VfMzogdHJ1ZVxuICAgICwgYWxsOlxuICAgICAgICBAe30gc3RhZ2VfMzogdHJ1ZVxuICAgICAgICAgICwgdGFyZ2V0czogQHt9IG5vZGU6IHRydWUsIGJyb3dzZXI6IHRydWVcbiAgICAgICAgICAsIG9mZnNpZGU6IEB7fSBjaGVja19ibG9ja3M6ICdcXC9ub2RlX21vZHVsZXNcXC98XFxcXG5vZGVfbW9kdWxlc1xcXFwvJ1xuXG5pZiBhcmd2LmluY2x1ZGVzIEAgJy0taGVscCcgOjpcbiAgY29uc29sZS5sb2cgQFxuICAgIEBbXSAnJ1xuICAgICAgLCAnICBVc2FnZToganN5LWluaXQgW29wdGlvbnNdJ1xuICAgICAgLCAnJ1xuICAgICAgLCAnICBQdXJwb3NlOiBDb25maWd1cmVzIHRoZSBwYWNrYWdlLmpzb24gd2l0aCBCYWJlbCBzZXR0aW5ncywgZGV2RGVwZW5kZW5jaWVzLCBhbmQgY29tbW9uIHNjcmlwdHMgZm9yIHF1aWNrbHkgc3RhcnRpbmcgYSBuZXcgcHJvamVjdC4nXG4gICAgICAsICcnXG4gICAgICAsICcgIE9wdGlvbnM6J1xuICAgICAgLCAnJ1xuICAgICAgLCAnICAgIC0taGVscCAgICAgICAgICAgIG91dHB1dCB1c2FnZSBpbmZvcm1hdGlvbidcbiAgICAgICwgJyAgICAtLW5vX3N0YWdlXzMgICAgICBhZGQgYmFiZWwgY29uZmlnIG9wdGlvbiB0byBleGNsdWRlIHN0YWdlXzMgcHJlc2V0ICh1c2VkIHRvIHByZXZlbnQgYXN5bmMvYXdhaXQgY29kZSBnZW5lcmF0aW9uKSdcbiAgICAgICwgJyAgICAtLW9wdGlvbnMgICAgICAgICBhZGQgYWxsIGJhYmVsIGNvbmZpZyBvcHRpb25zIGZvciBKU1kgZm9yIGxhdGVyIGVkaXRpbmcnXG4gICAgICAsICcnXG4gICAgLmpvaW4oJ1xcbicpXG5cbmVsc2UgOjpcbiAgaWYgYXJndi5pbmNsdWRlcyBAICctLW5vX3N0YWdlXzMnIHx8IGFyZ3YuaW5jbHVkZXMgQCAnLS1ub19zdGFnZTMnIDo6XG4gICAganN5X29wdGlvbnMgPSBPYmplY3QuYXNzaWduIEAge30sIGpzeV9vcHRpb25zLCBqc3lfb3B0aW9uX3NldHMubm9fc3RhZ2VfM1xuXG4gIGlmIGFyZ3YuaW5jbHVkZXMgQCAnLS1vcHRpb25zJyA6OlxuICAgIGpzeV9vcHRpb25zID0gT2JqZWN0LmFzc2lnbiBAIHt9LCBqc3lfb3B0aW9ucywganN5X29wdGlvbl9zZXRzLmFsbFxuICAgIFxuICB0cmFuc2Zvcm1QYWNrYWdlSnNvbigpXG5cblxuZnVuY3Rpb24gdHJhbnNmb3JtUGFja2FnZUpzb24oZmlsZW5hbWU9Jy4vcGFja2FnZS5qc29uJykgOjpcbiAgbmV3IFByb21pc2UgQCAocmVzb2x2ZSwgcmVqZWN0KSA9PlxuICAgIGZzLnJlYWRGaWxlIEAgZmlsZW5hbWUsICd1dGYtOCcsXG4gICAgICAoZXJyLCBjb250ZW50KSA9PiBlcnIgPyByZWplY3QoZXJyKSA6IHJlc29sdmUoY29udGVudClcblxuICAudGhlbiBAIGNvbnRlbnQgPT4gSlNPTi5wYXJzZSBAIGNvbnRlbnRcblxuICAudGhlbiBAIHBrZyA9PiA6OlxuICAgIGNvbnNvbGUubG9nIEBcbiAgICAgIEBbXSAnJywgYE1lcmdpbmcgc2V0dGluZ3MgaW50byBcIiR7ZmlsZW5hbWV9XCI6YFxuICAgICAgICAsIEpTT04uc3RyaW5naWZ5IEAgc2V0dXBQYWNrYWdlSnNvbih7fSksIG51bGwsIDJcbiAgICAgICAgLCAnJ1xuICAgICAgLmpvaW4oJ1xcbicpXG4gICAgcmV0dXJuIHNldHVwUGFja2FnZUpzb24ocGtnKVxuXG4gIC50aGVuIEAgcGtnID0+IEpTT04uc3RyaW5naWZ5KHBrZywgbnVsbCwgMilcblxuICAudGhlbiBAIGNvbnRlbnQgPT5cbiAgICBuZXcgUHJvbWlzZSBAIChyZXNvbHZlLCByZWplY3QpID0+XG4gICAgICBmcy53cml0ZUZpbGUgQCBmaWxlbmFtZSwgY29udGVudCxcbiAgICAgICAgKGVycikgPT4gZXJyID8gcmVqZWN0KGVycikgOiByZXNvbHZlKGNvbnRlbnQpXG5cbiAgLnRoZW4gQCBjb250ZW50ID0+IGNvbnNvbGUubG9nIEAgYFdyb3RlIG1lcmdlZCBKU1kgc2V0dGluZ3MgaW50byBcIiR7ZmlsZW5hbWV9XCJgXG5cblxuZnVuY3Rpb24gc2V0dXBQYWNrYWdlSnNvbihwa2cpIDo6XG4gIHBrZy5kZXZEZXBlbmRlbmNpZXMgPSBzZXR1cERldkRlcGVuZGVuY2llcyBAIHBrZy5kZXZEZXBlbmRlbmNpZXMgfHwge31cbiAgcGtnLmJhYmVsID0gc2V0dXBCYWJlbFByZXNldHMgQCBwa2cuYmFiZWwgfHwge31cbiAgcGtnLnNjcmlwdHMgPSBzZXR1cFNjcmlwdHMgQCBwa2cuc2NyaXB0cyB8fCB7fVxuICByZXR1cm4gcGtnXG5cblxuZnVuY3Rpb24gc2V0dXBEZXZEZXBlbmRlbmNpZXMoZGV2RGVwZW5kZW5jaWVzKSA6OlxuICBkZXZEZXBlbmRlbmNpZXNbJ2JhYmVsLWNsaSddID0gYmFiZWxfcHJlc2V0X2pzeV9qc29uLmRldkRlcGVuZGVuY2llc1snYmFiZWwtY2xpJ11cbiAgZGV2RGVwZW5kZW5jaWVzWydiYWJlbC1wcmVzZXQtanN5J10gPSBgXiR7YmFiZWxfcHJlc2V0X2pzeV9qc29uLnZlcnNpb259YFxuICBkZXZEZXBlbmRlbmNpZXNbJ25vZGVtb24nXSA9ICcqJ1xuICByZXR1cm4gZGV2RGVwZW5kZW5jaWVzXG5cblxuY29uc3QgZXhpc3RpbmdfanN5X21vZGVzID0gbmV3IFNldCBAIyAnanN5JywgJ2pzeS9sZWFuJ1xuXG5mdW5jdGlvbiBzZXR1cEJhYmVsUHJlc2V0cyhiYWJlbCkgOjpcbiAgaWYgISBiYWJlbC5wcmVzZXRzIDo6XG4gICAgYmFiZWwucHJlc2V0cyA9IFtdXG4gIGVsc2UgaWYgJ3N0cmluZycgPT09IGJhYmVsLnByZXNldHMgOjpcbiAgICBiYWJlbC5wcmVzZXRzID0gW2JhYmVsLnByZXNldHNdXG4gIFxuICBpZiBiYWJlbC5wcmVzZXRzLmZpbmQgQCBlID0+IGV4aXN0aW5nX2pzeV9tb2Rlcy5oYXMoZSkgfHwgZXhpc3RpbmdfanN5X21vZGVzLmhhcyhlWzBdKSA6OlxuICAgIGNvbnNvbGUubG9nIEAgJ0V4aXN0aW5nIEpTWSBzZXR0aW5ncyBmb3VuZC4gUGxlYXNlIGVkaXQgQmFiZWwgc2V0dGluZ3MgbWFudWFsbHknXG4gIGVsc2UgOjpcbiAgICBiYWJlbC5wcmVzZXRzLnB1c2ggQCBqc3lfb3B0aW9ucyA/IFtqc3lfbW9kZSwganN5X29wdGlvbnNdIDoganN5X21vZGVcblxuICByZXR1cm4gYmFiZWxcblxuZnVuY3Rpb24gc2V0dXBTY3JpcHRzKHNjcmlwdHMpIDo6XG4gIGlmICFzY3JpcHRzLnN0YXJ0IDo6XG4gICAgc2NyaXB0cy5zdGFydCA9ICdub2RlIGRpc3QnXG5cbiAgaWYgIXNjcmlwdHNbJ3N0YXJ0OmRldiddIDo6XG4gICAgc2NyaXB0c1snc3RhcnQ6ZGV2J10gPSAnbm9kZW1vbiAtZCAyIGRpc3QnXG5cbiAgaWYgIXNjcmlwdHMuYnVpbGQgOjpcbiAgICBzY3JpcHRzLmJ1aWxkID0gJ2JhYmVsIC1zIGlubGluZSAteCAuanMsLmpzeSBjb2RlIC1kIGRpc3QnXG5cbiAgaWYgIXNjcmlwdHMud2F0Y2ggOjpcbiAgICBzY3JpcHRzLndhdGNoID0gJ25wbSAtcyBydW4gYnVpbGQgLS0gLS13YXRjaCdcblxuICBpZiAhc2NyaXB0cy5wcmV0ZXN0IDo6XG4gICAgc2NyaXB0cy5wcmV0ZXN0ID0gJ25wbSAtcyBydW4gYnVpbGQnXG5cbiAgaWYgIXNjcmlwdHMudGVzdG9uZSA6OlxuICAgIHNjcmlwdHMudGVzdG9uZSA9ICdiYWJlbC1ub2RlIHRlc3QvZXhhbXBsZS5qc3knXG5cbiAgcmV0dXJuIHNjcmlwdHNcblxuIl19